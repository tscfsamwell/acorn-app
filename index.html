<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Samwell ‚Ä¢ Tree & Journal</title>
<meta name="theme-color" content="#0f3a2f"/>

<style>
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
:root{
  --sky1:#0f3a2f; --sky2:#0d3329; --sky3:#0a2b23;
  --accent:#bfe8cf; --accent2:#98d8bb; --text:#ecfff6;
  --card:#08251e; --line:rgba(255,255,255,.15); --glow:rgba(163,227,194,.25);
  --nav-h:68px;
}
body{background:linear-gradient(180deg,var(--sky1) 0%, var(--sky2) 30%, var(--sky3) 100%); color:var(--text)}
.appWrap{min-height:100vh; padding-bottom:calc(var(--nav-h) + env(safe-area-inset-bottom))}
.outerTab{display:none} .outerTab.active{display:block}
main{max-width:560px;margin:0 auto;padding:16px 16px 44px}
h1{font-size:20px;margin:0}
.forestName{opacity:.9;font-size:13px;margin-left:8px}

/* ---- YouTube feed cards ---- */
.feedList{display:flex;flex-direction:column;gap:14px}
.vidCard{border:1px solid var(--line);background:rgba(255,255,255,.06);border-radius:12px;overflow:hidden}
.vidThumb{position:relative;aspect-ratio:16/9;background:#000}
.vidThumb img{width:100%;height:100%;object-fit:cover;display:block;opacity:.95}
.playBtn{position:absolute;left:10px;bottom:10px;border:0;cursor:pointer;padding:10px 12px;border-radius:999px;background:rgba(0,0,0,.55);color:#fff;font-weight:700}
.vTitle{padding:10px 12px;font-weight:700}
.vMeta{padding:0 12px 12px;opacity:.8;font-size:12px}
.ytWrap{position:relative;width:100%;aspect-ratio:16/9;background:rgba(0,0,0,.3);border-radius:12px;overflow:hidden}
.ytWrap iframe{position:absolute;inset:0;width:100%;height:100%}

/* Stage header */
.rings{display:flex;gap:6px;align-items:center;margin:10px 0 6px}
.ring{width:12px;height:12px;border:2px solid var(--accent);border-radius:50%}
.ring.filled{background:var(--accent)}
.stageWrap{display:flex;align-items:center;gap:10px}
.stageBar{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.12);overflow:hidden}
.stageFill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .35s}
.stageName{min-width:98px;font-size:13px;opacity:.9}
.stageCP{font-size:12px;opacity:.85;min-width:74px;text-align:right}

/* Scene */
#stage{position:relative;width:100%;aspect-ratio:3/4;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-top:6px}
.scene{position:absolute;inset:0;display:grid;place-items:center;background:
  radial-gradient(ellipse at 50% 85%, rgba(0,0,0,.25) 0%, rgba(0,0,0,0) 40%),
  radial-gradient(ellipse at 50% 15%, rgba(255,255,255,.12) 0%, rgba(255,255,255,0) 55%),
  linear-gradient(180deg,var(--sky1) 0%,var(--sky2) 60%,var(--sky3) 100%);}
.parallax{position:absolute;inset:0;pointer-events:none}
.layer{position:absolute;inset:0;opacity:.35}
.layer.back{animation:drift 18s ease-in-out infinite; transform:translateY(2%)}
.layer.mid {animation:drift 14s ease-in-out infinite; opacity:.45}
.layer.front{animation:drift 10s ease-in-out infinite; opacity:.55}
@keyframes drift{0%{transform:translateY(1%)}50%{transform:translateY(-1%)}100%{transform:translateY(1%)}}
.forestTree{position:absolute;bottom:8%;opacity:.32;filter:blur(.2px) drop-shadow(0 4px 10px rgba(0,0,0,.3))}
.ground{position:absolute;left:0;right:0;bottom:-6%;height:28%;background:radial-gradient(ellipse at 50% 20%, color-mix(in oklab, var(--sky2) 88%, black 0%) 0%, color-mix(in oklab, var(--sky3) 88%, black 0%) 45%, #0b3528 100%);box-shadow:0 -10px 40px inset rgba(0,0,0,.25); z-index:1}
.glow{position:absolute;inset:0;background:radial-gradient(circle at 50% 25%, var(--glow), transparent 45%); z-index:1}

svg.tree{width:92%;height:auto;filter:drop-shadow(0 6px 18px rgba(0,0,0,.35)); z-index:2}
.sway{animation:sway 6s ease-in-out infinite}
@keyframes sway{0%{transform:rotate(-1.2deg)}50%{transform:rotate(1.2deg)}100%{transform:rotate(-1.2deg)}}

/* Acorn screen */
#acornScreen{position:absolute;inset:0;display:grid;place-items:center;gap:14px;z-index:3}
#acornBig{width:min(42vmin,220px);height:auto;filter:drop-shadow(0 10px 24px rgba(0,0,0,.4))}
.cta{display:inline-flex;align-items:center;gap:10px;background:var(--accent);color:#0b3d2e;border:none;border-radius:999px;padding:14px 18px;font-weight:800;font-size:16px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
.cta:active{transform:scale(.97)} .sprout{font-size:20px}

/* Controls & text */
.controls{display:flex;justify-content:space-between;gap:8px;margin-top:10px}
.ghost{background:transparent;color:var(--text);border:1px solid var(--line);border-radius:999px;padding:10px 14px}
.mantra{min-height:52px;text-align:center;font-size:16px;line-height:1.35;margin:10px 0 0}
.count{font-size:12px;opacity:.85;text-align:center;margin-top:6px}

/* Journal */
.journal{margin-top:14px}
label{font-size:13px;opacity:.95}
textarea{width:100%;min-height:84px;margin-top:6px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.05);color:var(--text);padding:12px;resize:vertical}
textarea::placeholder{color:#cdeede;opacity:.7}
.saveNote{font-size:12px;opacity:.75;margin-top:6px}

/* Profile tab */
.jTop{display:flex;justify-content:space-between;align-items:center;margin:8px 0 12px}
.statRow{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 12px}
.stat{background:rgba(255,255,255,.08);border:1px solid var(--line);padding:8px 10px;border-radius:10px;font-size:12px}
.entry{border:1px solid var(--line);background:rgba(255,255,255,.06);border-radius:12px;padding:10px;margin-bottom:10px}
.entry h4{margin:0 0 6px;font-size:14px}
.entry .meta{font-size:12px;opacity:.85;margin-bottom:6px}
.entry .note{white-space:pre-wrap;line-height:1.35}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.card{border:1px solid var(--line);background:rgba(255,255,255,.06);border-radius:12px;padding:12px;text-align:center}
.locked{opacity:.45;filter:grayscale(1)}
.card small{display:block;opacity:.8;margin-top:6px;font-size:11px}

/* Particles */
.leafParticle{position:fixed;will-change:transform,opacity;pointer-events:none;font-size:18px}

/* Dev panel */
#devPanel{position:fixed;right:10px;top:10px;z-index:9997;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);border:1px solid var(--line);border-radius:12px;padding:8px;display:none}
#devPanel h4{margin:0 0 6px;font-size:12px;letter-spacing:.3px;opacity:.8}
#devPanel button{margin:2px 3px;padding:6px 8px;border-radius:8px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);font-size:12px}
.danger{border-color:rgba(255,120,120,.4)!important;color:#ffd7d7!important}

/* Coach/Toast/Breath */
#coach{position:fixed;inset:0;pointer-events:none;z-index:10000}
.coachMask{position:absolute;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);opacity:0;transition:opacity .15s}
#coach.show .coachMask{opacity:1}
.coachCard{position:absolute;max-width:260px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;box-shadow:0 12px 30px rgba(0,0,0,.35);opacity:0;transform:translateY(6px);transition:opacity .18s, transform .18s;pointer-events:auto}
#coach.show .coachCard{opacity:1;transform:translateY(0)}
.coachText{font-size:14px;line-height:1.35;margin:0 0 8px}
.coachBtns{display:flex;gap:8px;justify-content:flex-end}
.coachBtn{background:var(--accent);color:#0b3d2e;border:none;border-radius:10px;padding:8px 10px;font-weight:700}
.coachSkip{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.25)}
.coachArrow{position:absolute;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:10px solid var(--card)}
#toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .2s;z-index:10001}
#toast.show{opacity:1}
#breath{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);z-index:10002}
#breathCard{width:min(520px,90vw);background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px 18px 16px;color:var(--text);text-align:center;box-shadow:0 14px 36px rgba(0,0,0,.4)}
#bTitle{font-weight:700;margin:0 0 2px}
#bSubtitle{margin:0 0 6px;opacity:.85;font-size:13px}
#bCircle{width:180px;height:180px;border-radius:50%;margin:14px auto 10px;background:radial-gradient(circle at 50% 40%, var(--accent), color-mix(in oklab, var(--accent) 65%, black 0%));opacity:.95;transform:scale(.92);transition:transform 3.2s ease-in-out}
#bText{margin:0 0 10px;opacity:.9}
#bDots{display:flex;gap:6px;justify-content:center;margin-bottom:10px}
.bDot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.25)}
.bDot.on{background:var(--accent)}
.bBtns{display:flex;gap:8px;justify-content:center}
.bBtn{border:1px solid var(--line);background:transparent;color:var(--text);padding:8px 12px;border-radius:10px}
.bBtn.primary{background:var(--accent);color:#0b3d2e;font-weight:800}

/* Bottom nav */
nav{position:fixed;left:0;right:0;bottom:0;z-index:50;height:calc(var(--nav-h) + env(safe-area-inset-bottom));padding-bottom:env(safe-area-inset-bottom);background:rgba(10,18,16,.9);backdrop-filter:saturate(120%) blur(10px);border-top:1px solid var(--line)}
.tabs{height:var(--nav-h);display:grid;grid-template-columns:repeat(5,1fr);align-items:stretch}
.tab{appearance:none;border:0;background:transparent;color:rgba(255,255,255,.7);font:600 12px/1 system-ui,-apple-system,Segoe UI,Roboto;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;cursor:pointer}
.tab svg{width:22px;height:22px;opacity:.95}
.tab.active{color:var(--accent)}
.tab.center .icon{width:46px;height:46px;border-radius:50%;background:radial-gradient(110% 110% at 30% 20%, #7ff0a0, #4cc977);color:#0a0d10;display:grid;place-items:center;border:2px solid rgba(255,255,255,.12);box-shadow:0 6px 20px rgba(102,209,122,.35)}
.cardSimple{max-width:560px;margin:18px auto;padding:16px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid var(--line)}
.muted{opacity:.8}
</style>
</head>

<body>
<div class="appWrap">

  <!-- HOME: YouTube -->
  <section id="tab-home" class="outerTab">
    <div class="cardSimple">
      <h2>Latest Videos</h2>
      <div id="ytFeed" class="feedList" aria-live="polite"><div class="muted">Loading‚Ä¶</div></div>
    </div>
  </section>

  <!-- TREE: minimal gameplay page -->
  <section id="tab-tree" class="outerTab active">
    <main>
      <header style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;align-items:center;gap:8px">
          <h1>Acorn</h1><div class="forestName" id="forestNameLabel"></div>
        </div>
      </header>

      <div class="rings" id="rings"></div>
      <div class="stageWrap">
        <div class="stageName" id="stageName">Acorn</div>
        <div class="stageBar"><div class="stageFill" id="stageFill"></div></div>
        <div class="stageCP" id="stageCP">0 CP</div>
      </div>

      <section id="stage" aria-live="polite">
        <div class="scene" id="scene">
          <div class="parallax">
            <div class="layer back" id="layerBack"></div>
            <div class="layer mid" id="layerMid"></div>
            <div class="layer front" id="layerFront"></div>
          </div>
          <div id="forestLayer" class="parallax"></div>

          <div id="acornScreen">
            <svg id="acornBig" viewBox="0 0 80 80" aria-hidden="true">
              <defs>
                <linearGradient id="acornNut" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="#c7995a"/><stop offset="100%" stop-color="#a7783d"/>
                </linearGradient>
                <linearGradient id="acornCap" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="#6f5036"/><stop offset="100%" stop-color="#553b28"/>
                </linearGradient>
              </defs>
              <ellipse cx="40" cy="48" rx="22" ry="26" fill="url(#acornNut)"/>
              <ellipse cx="40" cy="38" rx="26" ry="12" fill="url(#acornCap)"/>
              <rect x="42" y="24" width="10" height="6" rx="3" fill="#6b4b30" transform="rotate(-25 47 27)"/>
            </svg>
            <button id="plantBtn" class="cta"><span class="sprout">üå±</span>Plant Acorn</button>
          </div>

          <svg id="tree" class="tree sway" viewBox="0 0 300 430" aria-hidden="true" style="display:none">
            <defs>
              <linearGradient id="bark" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#7a5437"/><stop offset="100%" stop-color="#5a3e2b"/></linearGradient>
              <radialGradient id="leafGrad" cx="50%" cy="50%" r="65%"><stop offset="0%" stop-color="#d4fbe6"/><stop offset="100%" stop-color="#8fe3bb"/></radialGradient>
              <clipPath id="canopyClip"><ellipse cx="150" cy="170" rx="95" ry="65"/></clipPath>
            </defs>
            <path d="M150 400 C150 330 148 270 150 210 C153 165 156 125 150 90" stroke="url(#bark)" stroke-width="22" stroke-linecap="round" fill="none"/>
            <g id="leaves" clip-path="url(#canopyClip)"></g>
          </svg>

          <div class="ground"></div>
          <div class="glow"></div>
          <div id="creatureLayer" aria-hidden="true"></div>
        </div>
      </section>

      <p id="mantra" class="mantra"></p>
      <p class="count" id="leafCount"></p>

      <div class="controls">
        <button id="soundToggle" class="ghost" aria-pressed="false">Sound. On</button>
        <button id="resetBtn" class="ghost">New day</button>
      </div>

      <div class="journal">
        <label for="journalBox">Journal. How did today‚Äôs quote make you feel</label>
        <textarea id="journalBox" placeholder="Write a few lines for future you"></textarea>
        <div class="saveNote" id="saveNote">Saved</div>
      </div>

      <!-- Dev tools (hidden unless /dev on) -->
      <div id="devPanel">
        <h4>DEV</h4>
        <div>
          <button id="devAddCP">+5 CP</button>
          <button id="devNextStage">Next Stage (fast)</button>
          <button id="devLeaves">Full Leaves</button>
          <button id="devNight">Toggle Night</button>
          <button id="devReset" class="danger">Reset Progress</button><br>
          <button id="devFox">ü¶ä</button>
          <button id="devBird">üê¶</button>
          <button id="devButterfly">ü¶ã</button>
          <button id="devLady">üêû</button>
          <button id="devAnt">üêú</button>
          <button id="devOwl">ü¶â</button>
        </div>
      </div>
    </main>

    <!-- Coach + toast -->
    <div id="coach" aria-hidden="true">
      <div class="coachMask"></div>
      <div class="coachCard" id="coachCard">
        <p class="coachText" id="coachText"></p>
        <div class="coachBtns">
          <button class="coachBtn coachSkip" id="coachSkip">Skip</button>
          <button class="coachBtn" id="coachOk">Got it</button>
        </div>
        <div class="coachArrow" id="coachArrow"></div>
      </div>
    </div>
    <div id="toast" role="status" aria-live="polite"></div>

    <!-- Breath overlay -->
    <div id="breath" aria-hidden="true">
      <div id="breathCard" role="dialog" aria-modal="true" aria-labelledby="bTitle">
        <h3 id="bTitle">Breathe with the tree</h3>
        <div id="bSubtitle">4 easy cycles ‚Ä¢ ~30s</div>
        <div id="bCircle" aria-hidden="true"></div>
        <div id="bText">Inhale</div>
        <div id="bDots"><span class="bDot"></span><span class="bDot"></span><span class="bDot"></span><span class="bDot"></span></div>
        <div class="bBtns">
          <button class="bBtn" id="bSkip">Skip</button>
          <button class="bBtn primary" id="bFinish">Finish</button>
        </div>
      </div>
    </div>
  </section>

  <!-- PROFILE: stats + entries + gallery + achievements -->
  <section id="tab-profile" class="outerTab">
    <main>
      <div class="jTop"><div style="font-weight:700">Profile</div></div>
      <div class="statRow">
        <div class="stat">Forest: <span id="forestNameStat"></span></div>
        <div class="stat">Streak: <span id="streakStat">0</span> days</div>
        <div class="stat">Total CP: <span id="cpStat">0</span></div>
        <div class="stat">Forest trees: <span id="forestCountStat">0</span></div>
        <div class="stat">Entries: <span id="entryCountStat">0</span></div>
      </div>
      <div id="entryList"></div>

      <div class="jTop"><div style="font-weight:700">Creature Gallery</div></div>
      <div class="grid" id="galleryGrid"></div>

      <div class="jTop"><div style="font-weight:700">Achievements</div></div>
      <div class="grid" id="achGrid"></div>
    </main>
  </section>

  <!-- STORE / EXPLORE (placeholders) -->
  <section id="tab-store" class="outerTab"><div class="cardSimple"><h2>Store</h2><p class="muted">Book, audiobook, merch and app cosmetics will live here.</p><p><a class="btn" href="https://www.under-the-oak.com" target="_blank" rel="noopener">Visit under-the-oak.com ‚Üí</a></p></div></section>
  <section id="tab-explore" class="outerTab"><div class="cardSimple"><h2>Explore</h2><p class="muted">Explore themes/topics and search specific problems or solutions.</p></div></section>

</div>

<!-- Bottom navigation -->
<nav aria-label="Primary">
  <div class="tabs">
    <button class="tab" data-tab="home" aria-label="Home">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"/></svg>
      <span>Home</span>
    </button>
    <button class="tab" data-tab="profile" aria-label="Profile">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 100-10 5 5 0 000 10zm-7 9a7 7 0 1114 0H5z"/></svg>
      <span>Profile</span>
    </button>
    <button class="tab center active" data-tab="tree" aria-label="Tree">
      <div class="icon">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a6 6 0 016 6 4 4 0 11-8 0A6 6 0 006 14a4 4 0 004 4h1v4h2v-4h1a6 6 0 000-12 6 6 0 00-2-4z"/></svg>
      </div>
      <span style="margin-top:4px">Tree</span>
    </button>
    <button class="tab" data-tab="store" aria-label="Store">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 4h10l1 4H6l1-4zm-1 6h12v9H6v-9zm3 2v5h2v-5H9zm4 0v5h2v-5h-2z"/></svg>
      <span>Store</span>
    </button>
    <button class="tab" data-tab="explore" aria-label="Explore">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.5 3a7.5 7.5 0 105.3 12.8l4.2 4.2 1.4-1.4-4.2-4.2A7.5 7.5 0 0010.5 3zm0 2a5.5 5.5 0 110 11 5.5 5.5 0 010-11z"/></svg>
      <span>Explore</span>
    </button>
  </div>
</nav>

<script>
/* ===================== Core Game ===================== */
const QUOTES = [
  "Roots grow deeper when you‚Äôre quiet inside.",
  "Observation is love in practice.",
  "Small actions carry long echoes.",
  "Be kinder than you feel."
];

const ringsEl = document.getElementById('rings');
const forestLayer = document.getElementById('forestLayer');
const plantBtn = document.getElementById('plantBtn');
const acornScreen = document.getElementById('acornScreen');
const treeSVG = document.getElementById('tree');
const leavesLayer = document.getElementById('leaves');
const mantraEl = document.getElementById('mantra');
const leafCountEl = document.getElementById('leafCount');
const soundToggle = document.getElementById('soundToggle');
const resetBtn = document.getElementById('resetBtn');
const journalBox = document.getElementById('journalBox');
const saveNote = document.getElementById('saveNote');
const stageNameEl = document.getElementById('stageName');
const stageFillEl = document.getElementById('stageFill');
const stageCPEl   = document.getElementById('stageCP');
const creatureLayer = document.getElementById('creatureLayer');
const layerBack = document.getElementById('layerBack');
const layerMid = document.getElementById('layerMid');
const layerFront = document.getElementById('layerFront');

/* Profile tab els */
const forestNameLabel = document.getElementById('forestNameLabel');
const forestNameStat = document.getElementById('forestNameStat');
const streakStat = document.getElementById('streakStat');
const cpStat = document.getElementById('cpStat');
const forestCountStat = document.getElementById('forestCountStat');
const entryCountStat = document.getElementById('entryCountStat');
const entryList = document.getElementById('entryList');
const galleryGrid = document.getElementById('galleryGrid');
const achGrid = document.getElementById('achGrid');

/* Audio */
let audioEnabled = true;
let SND_VOL = 0.9;
let _ctx = null, _gain = null, _unlocked = false;
const _audioCache = new Map();
const SND = { cpGain:["cp1.m4a","cp2.m4a","cp3.m4a"], plant:["plant1.m4a","plant2.m4a"], level:["level1.m4a","level2.m4a"], creature:["visit1.m4a","visit2.m4a","visit3.m4a"] };
function ensureAudio(){ if(_ctx) return; _ctx = new (window.AudioContext||window.webkitAudioContext)(); _gain=_ctx.createGain(); _gain.gain.value=SND_VOL; _gain.connect(_ctx.destination); }
function primeAudio(){ ensureAudio(); if(_unlocked) return; try{ const b=_ctx.createBuffer(1,1,22050); const s=_ctx.createBufferSource(); s.buffer=b; s.connect(_gain); s.start(0); _ctx.resume(); _unlocked=true; }catch{} }
document.addEventListener('pointerdown', primeAudio, {once:true, passive:true});
function getHtmlAudio(path){ if(!_audioCache.has(path)){ const a=new Audio(path); a.preload='auto'; _audioCache.set(path,a); } const base=_audioCache.get(path); const el=base.cloneNode(true); el.volume=SND_VOL; return el; }
async function playFile(file){ if(!audioEnabled) return; try{ const a=getHtmlAudio(file.startsWith('sounds/')?file:`sounds/${file}`); if(_ctx && _ctx.state==='suspended') await _ctx.resume(); await a.play(); }catch{} }
function playFrom(list){ const pick=list[Math.floor(Math.random()*list.length)]; playFile(pick); }
const SOUND = { cpGain(){playFrom(SND.cpGain)}, plant(){playFrom(SND.plant)}, level(){playFrom(SND.level)}, creature(){playFrom(SND.creature)} };

/* State */
const storeKey='acorn.master.sage.v2';
function todayMidnight(){const d=new Date(); d.setHours(0,0,0,0); return +d;}
function ymd(ts){const d=new Date(ts); return d.toISOString().slice(0,10);}
function randInt(min,max){return Math.floor(min+Math.random()*(max-min+1));}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
function makeCycle(){ return {seed:Math.floor(Math.random()*2**31), total:randInt(120,260), left:0, quoteIdx:-1, journal:""}; }
function makeDay(){ return {leafCP:0, journalGiven:false, plantedGiven:false, logged:false}; }
function loadState(){ const d=todayMidnight(), raw=localStorage.getItem(storeKey); if(raw){ const s=JSON.parse(raw); if(s.date!==d){ s.date=d; s.day=makeDay(); } return s; } return {date:d, planted:false, cycle:makeCycle(), cp:0, day:makeDay(), dots:0, forest:0, name:"", entries:[], dev:0, simNight:0, onb:{plant:0,leaves:0,journal:0,dots:0,menu:0,creature:0,never:0}, gallery:{'ü¶ã':0,'üê¶':0,'üêú':0,'üêû':0,'ü¶ä':0,'ü¶â':0}, ach:{}, theme:{}, volume:0.9}; }
const state = loadState(); SND_VOL = state.volume ?? 0.9;

/* Themes + stage */
const PRESETS = {sage:{sky1:'#0f3a2f',sky2:'#0d3329',sky3:'#0a2b23',accent:'#bfe8cf',accent2:'#98d8bb',text:'#ecfff6'}};
function setCSSVars(s1,s2,s3,acc1,acc2,txt){const r=document.documentElement;r.style.setProperty('--sky1',s1);r.style.setProperty('--sky2',s2);r.style.setProperty('--sky3',s3);r.style.setProperty('--accent',acc1);r.style.setProperty('--accent2',acc2);r.style.setProperty('--text',txt);}
function applyPreset(name){const p=PRESETS[name]; if(!p) return; setCSSVars(p.sky1,p.sky2,p.sky3,p.accent,p.accent2,p.text); state.theme={preset:name,custom:false}; saveState();}
function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

const STAGES=[{name:'Acorn',min:0},{name:'Sprout',min:5},{name:'Sapling',min:15},{name:'Young Tree',min:30},{name:'Full Tree',min:50},{name:'Grove',min:80}];
function currentStageIndex(cp){ let i=0; for(let k=0;k<STAGES.length;k++) if(cp>=STAGES[k].min) i=k; return i; }
function nextStageTarget(cp){ const i=currentStageIndex(cp); return i>=STAGES.length-1 ? STAGES[i].min+20 : STAGES[i+1].min; }
function updateStageBar(){ const idx=currentStageIndex(state.cp); const stage=STAGES[idx], next=STAGES[Math.min(idx+1,STAGES.length-1)]; const rangeMax= next.min===stage.min ? stage.min+20 : next.min; const pct=Math.max(0,Math.min(100,((state.cp-stage.min)/(rangeMax-stage.min))*100)); stageNameEl.textContent=stage.name; stageCPEl.textContent=`${Math.round(state.cp)} CP`; stageFillEl.style.width=pct+'%'; }

/* Seasons/parallax */
function applySeason(){ const pal=PRESETS.sage; if(!state.theme || !state.theme.custom){ setCSSVars(pal.sky1,pal.sky2,pal.sky3,getVar('--accent'),getVar('--accent2'),getVar('--text')); }
  layerBack.innerHTML=`<svg width="100%" height="100%"><ellipse cx="18%" cy="32%" rx="22%" ry="18%" fill="rgba(255,255,255,.04)"/></svg>`;
  layerMid.innerHTML =`<svg width="100%" height="100%"><ellipse cx="74%" cy="24%" rx="18%" ry="14%" fill="rgba(255,255,255,.05)"/></svg>`;
  layerFront.innerHTML=`<svg width="100%" height="100%"><ellipse cx="42%" cy="18%" rx="16%" ry="12%" fill="rgba(255,255,255,.06)"/></svg>`;
}

/* Dots & background forest */
function updateDotsUI(){ ringsEl.innerHTML=''; for(let i=0;i<5;i++){ const d=document.createElement('div'); d.className='ring'; if(i<state.dots) d.classList.add('filled'); ringsEl.appendChild(d); } }
function addBackgroundTree(){ const wrap=document.createElement('div'); wrap.className='forestTree'; const left=Math.random()<0.5?randInt(6,26):randInt(58,86); const scale=(Math.random()*0.4+0.7); wrap.style.left=left+'%'; wrap.style.transform=`translateX(-50%) scale(${scale})`; wrap.innerHTML=`<svg width="120" height="160" viewBox="0 0 120 160" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><defs><linearGradient id="barkSoft" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#5c4430"/><stop offset="100%" stop-color="#3f2e22"/></linearGradient><radialGradient id="leafSoft" cx="50%" cy="40%" r="60%"><stop offset="0%" stop-color="#a5d9c1"/><stop offset="100%" stop-color="#6fb899"/></radialGradient></defs><path d="M60 150 L60 95" stroke="url(#barkSoft)" stroke-width="14" stroke-linecap="round"/><ellipse cx="60" cy="70" rx="44" ry="32" fill="url(#leafSoft)"/></svg>`; forestLayer.appendChild(wrap); }
function renderForest(){ forestLayer.innerHTML=''; for(let i=0;i<(state.forest||0); i++) addBackgroundTree(); }

/* Tree & leaves */
function setTreeVisible(on){ treeSVG.style.display = on ? 'block' : 'none'; }
function renderLeaves(){ leavesLayer.innerHTML=''; const cx=150, cy=170, rx=95, ry=65; const rnd=mulberry32(state.cycle.seed); const grad='url(#leafGrad)'; const N=state.cycle.left; for(let i=0;i<N;i++){ const a=2*Math.PI*rnd(); const r=Math.sqrt(rnd()); const x=cx+r*rx*Math.cos(a), y=cy+r*ry*Math.sin(a); const s=0.8+rnd()*0.6; const e=document.createElementNS('http://www.w3.org/2000/svg','ellipse'); e.setAttribute('cx',x); e.setAttribute('cy',y); e.setAttribute('rx',4*s); e.setAttribute('ry',6*s); e.setAttribute('fill',grad); e.setAttribute('opacity',0.95); leavesLayer.appendChild(e); } }
function showAcorn(){ acornScreen.style.display='grid'; setTreeVisible(false); updateQuote(); updateCounts(); }
function showTree(){ acornScreen.style.display='none'; setTreeVisible(true); renderLeaves(); updateQuote(); updateCounts(); }

/* Creatures (subset) */
const CREATURES=[{icon:'ü¶ã',minCP:5,zone:'sky',chance:0.30,duration:6000},{icon:'üê¶',minCP:15,zone:'sky',chance:0.25,duration:6500},{icon:'üêú',minCP:10,zone:'bark',chance:0.18,duration:12000},{icon:'üêû',minCP:12,zone:'bark',chance:0.18,duration:12000},{icon:'ü¶ä',minCP:30,zone:'ground',chance:0.14,duration:16000}];
function spawnCreature(def){ const el=document.createElement('div'); el.className=`creature ${def.zone}`; el.textContent=def.icon;
  if(def.zone==='sky'){ el.style.top=(18+Math.random()*36)+'%'; el.classList.add('fly'); }
  else if(def.zone==='bark'){ el.style.left='50%'; el.style.bottom=(20+Math.random()*30)+'%'; el.style.transform='translateX(-50%)'; el.classList.add('crawl'); }
  else { el.classList.add('fox'); }
  creatureLayer.appendChild(el); setTimeout(()=>el.remove(), def.duration||8000);
  state.gallery[def.icon]=1; saveState(); buildGallery(); SOUND.creature();
}
function maybeCreatureVisit(trigger='tap'){ let pool=CREATURES.filter(c=>state.cp>=c.minCP); if(pool.length===0) return; const mult=trigger==='plant'?1.8:1.0; const pick=pool[Math.floor(Math.random()*pool.length)]; if(Math.random()<=(pick.chance*mult)) spawnCreature(pick); }

/* Counts & quote */
function updateCounts(){ leafCountEl.textContent = state.planted ? `Leaves left. ${state.cycle.left} of ${state.cycle.total}` : ''; }
function updateQuote(){ mantraEl.textContent = (state.planted && state.cycle.quoteIdx>=0) ? QUOTES[state.cycle.quoteIdx] : ''; }
function addCP(n){ state.cp+=n; saveState(); updateStageBar(); SOUND.cpGain(); }

/* Achievements (for profile UI) */
const ACH=[{id:'firstPlant',name:'First Sprout',desc:'Plant your first acorn',test:s=>s.entries.length>=1},{id:'journal10',name:'Pages Turned',desc:'Journal 10 times',test:s=>(s.entries||[]).filter(e=>e.note&&e.note.trim().length>0).length>=10},{id:'cp50',name:'Growing Strong',desc:'Reach 50 CP',test:s=>s.cp>=50},{id:'forest5',name:'Tiny Grove',desc:'Grow 5 background trees',test:s=>s.forest>=5},{id:'foxSeen',name:'Foxy Friend',desc:'See a fox',test:s=>s.gallery['ü¶ä']===1}];
function checkAchievements(){ state.ach=state.ach||{}; ACH.forEach(a=>{ if(!state.ach[a.id] && a.test(state)){ state.ach[a.id]=1; saveState(); buildAchievements(); } }); }

/* Breath flow */
const breathEl=document.getElementById('breath'), bCircle=document.getElementById('bCircle'), bText=document.getElementById('bText'), bDots=Array.from(document.querySelectorAll('#bDots .bDot')), bSkip=document.getElementById('bSkip'), bFinish=document.getElementById('bFinish');
let breathTimer=null, breathStep=0, breathRound=0;
const BREATH_STEPS=[{label:'Inhale',scale:1.12,ms:3200},{label:'Hold',scale:1.12,ms:1200},{label:'Exhale',scale:0.90,ms:3600},{label:'Hold',scale:0.90,ms:800}], BREATH_ROUNDS=4;
function showBreath(){ breathRound=0; breathStep=0; bDots.forEach(d=>d.classList.remove('on')); updateBreathDot(); breathEl.style.display='flex'; breathEl.setAttribute('aria-hidden','false'); runBreathStep(); }
function hideBreath(){ clearTimeout(breathTimer); breathTimer=null; breathEl.style.display='none'; breathEl.setAttribute('aria-hidden','true'); }
function updateBreathDot(){ bDots.forEach((d,i)=>d.classList.toggle('on',i<breathRound)); }
function runBreathStep(){ const s=BREATH_STEPS[breathStep]; bText.textContent=s.label; bCircle.style.transform=`scale(${s.scale})`; breathTimer=setTimeout(()=>{ breathStep=(breathStep+1)%BREATH_STEPS.length; if(breathStep===0){ breathRound++; updateBreathDot(); if(breathRound>=BREATH_ROUNDS){ finishDay(); return; } } runBreathStep(); }, s.ms); }
bSkip.addEventListener('click', ()=>finishDay()); bFinish.addEventListener('click', ()=>finishDay());
function finishDay(){ hideBreath(); logTodayEntry(); state.planted=false; saveState(); showAcorn(); SOUND.level(); }

/* Planting & daily flow */
function onPlanted(){ state.dots=(state.dots+1); if(state.dots>=5){ state.dots=0; state.forest=(state.forest||0)+1; addBackgroundTree(); applySeason(); } saveState(); updateDotsUI(); if(!state.day.plantedGiven){ state.day.plantedGiven=true; addCP(1);} maybeCreatureVisit('plant'); }
function logTodayEntry(){ if(state.day.logged) return; const ts=todayMidnight(); const entry={date:ts,dateISO:ymd(ts),stage:STAGES[currentStageIndex(state.cp)].name,quote:(state.cycle.quoteIdx>=0?QUOTES[state.cycle.quoteIdx]:""),note:(state.cycle.journal||"").trim()}; state.entries=state.entries||[]; state.entries.unshift(entry); state.day.logged=true; saveState(); checkAchievements(); }
function plant(){ state.planted=true; const total=randInt(120,260), seed=Math.floor(Math.random()*2**31); let idx=Math.floor(Math.random()*QUOTES.length); if(state.cycle && idx===state.cycle.quoteIdx && QUOTES.length>1) idx=(idx+1)%QUOTES.length; state.cycle={seed,total,left:total,quoteIdx:idx,journal:""}; saveState(); showTree(); SOUND.plant(); onPlanted(); }

/* Leaf tap / flick ‚Äî particles originate at the removed LEAF */
const stageEl=document.getElementById('stage'); let pointerStart=null;
function spawnLeafParticle(x,y,dx=0,dy=-1){
  const emoji=Math.random()<0.25?'üçÇ':'üçÉ';
  const el=document.createElement('div'); el.className='leafParticle'; el.textContent=emoji; el.style.left=x+'px'; el.style.top=y+'px';
  document.body.appendChild(el);
  const start=performance.now(), duration=1500+Math.random()*1400;
  const side=(Math.random()*120+50)*(Math.random()<0.5?-1:1);
  const baseX=dx*80+side*0.5, baseY=dy*(-120)-40;
  function frame(t){ const p=Math.min(1,(t-start)/duration), ease=1-Math.pow(1-p,2);
    const tx=x+baseX*ease, ty=y+baseY*ease+0.55*(p*220);
    el.style.transform=`translate(${tx-x}px,${ty-y}px) rotate(${p*240}deg)`; el.style.opacity=String(1-p);
    if(p<1) requestAnimationFrame(frame); else el.remove();
  } requestAnimationFrame(frame);
}
stageEl.addEventListener('pointerdown', e=>{ if(!state.planted) return; pointerStart={x:e.clientX,y:e.clientY}; });
stageEl.addEventListener('pointerup', e=>{
  if(!state.planted) return;
  let dx=0, dy=-1;
  if(pointerStart){ const vx=e.clientX-pointerStart.x, vy=e.clientY-pointerStart.y; const m=Math.hypot(vx,vy)||1; dx=vx/m; dy=vy/m; pointerStart=null; }
  const leaf=leavesLayer.lastElementChild; if(!leaf) return;
  const r=leaf.getBoundingClientRect(); const cx=r.left+r.width/2, cy=r.top+r.height/2;
  leaf.remove(); state.cycle.left--; saveState(); updateCounts(); SOUND.cpGain();
  spawnLeafParticle(cx,cy,dx,dy); maybeCreatureVisit('tap');
  if(state.cycle.left<=0){ showBreath(); }
}, {passive:true});

/* Profile UI builders */
function buildGallery(){ if(!galleryGrid) return; const list=['ü¶ã','üê¶','üêú','üêû','ü¶ä','ü¶â']; galleryGrid.innerHTML=''; list.forEach(icon=>{ const ok=state.gallery[icon]===1; const div=document.createElement('div'); div.className='card'+(ok?'':' locked'); div.innerHTML=`<div style="font-size:28px">${icon}</div><small>${ok?'Seen':'Locked'}</small>`; galleryGrid.appendChild(div); }); }
function buildAchievements(){ if(!achGrid) return; achGrid.innerHTML=''; ACH.forEach(a=>{ const ok=state.ach?.[a.id]; const div=document.createElement('div'); div.className='card'+(ok?'':' locked'); div.innerHTML=`<div style="font-weight:700">${a.name}</div><small>${a.desc}</small>`; achGrid.appendChild(div); }); }
function calcStreak(entries){ if(!entries||!entries.length) return 0; const days=new Set(entries.map(e=>e.dateISO)); let streak=0; let d=new Date(); d.setHours(0,0,0,0); while(days.has(d.toISOString().slice(0,10))){ streak++; d.setDate(d.getDate()-1); } return streak; }
function renderProfileTab(){
  forestNameStat.textContent = state.name || '‚Äî';
  forestCountStat.textContent = String(state.forest||0);
  cpStat.textContent = String(Math.round(state.cp||0));
  entryCountStat.textContent = String((state.entries||[]).length);
  streakStat.textContent = String(calcStreak(state.entries||[]));
  entryList.innerHTML='';
  (state.entries||[]).forEach(e=>{
    const div=document.createElement('div'); div.className='entry';
    div.innerHTML = `<h4>${e.dateISO} ‚Ä¢ ${e.stage}</h4>
      <div class="meta">Mantra ‚Äî ${e.quote?e.quote:'‚Äî'}</div>
      <div class="note">${e.note?e.note.replace(/</g,'&lt;'):'<em>No entry</em>'}</div>`;
    entryList.appendChild(div);
  });
  buildGallery(); buildAchievements();
}

/* Journal typing & dev */
let saveTimer=null;
function ensureForestName(){ if(!state.name){ const n=prompt("Name your forest üå≤","My Forest"); if(n){ state.name=n.slice(0,24); saveState(); } } forestNameLabel.textContent = state.name ? `‚Ä¢ ${state.name}` : ''; }
journalBox.addEventListener('input', ()=>{
  const cmd = journalBox.value.trim().toLowerCase();
  if(cmd==='/dev on'){ state.dev=1; saveState(); document.getElementById('devPanel').style.display='block'; showToast('Dev tools enabled'); return; }
  if(cmd==='/dev off'){ state.dev=0; saveState(); document.getElementById('devPanel').style.display='none'; showToast('Dev tools disabled'); return; }
  saveNote.textContent='Saving...'; clearTimeout(saveTimer);
  saveTimer=setTimeout(()=>{
    state.cycle.journal = journalBox.value.slice(0,1000); saveState(); saveNote.textContent='Saved';
    if(!state.day.journalGiven && state.cycle.journal.trim().length >= 10){ state.day.journalGiven = true; addCP(2); }
  }, 350);
});

/* Dev buttons */
function applyDevUI(){ document.getElementById('devPanel').style.display = state.dev ? 'block' : 'none'; }
document.getElementById('devAddCP').addEventListener('click', ()=> addCP(5));
document.getElementById('devNextStage').addEventListener('click', ()=>{
  const target=nextStageTarget(state.cp); const start=state.cp, delta=target-start, dur=1100, t0=performance.now();
  (function step(t){ const p=Math.min(1,(t-t0)/dur); const ease=p<.5?2*p*p:1-Math.pow(-2*p+2,2)/2; state.cp=start+delta*ease; updateStageBar();
    if(p<1) requestAnimationFrame(step); else {state.cp=target; saveState(); updateStageBar();}})(t0);
});
document.getElementById('devLeaves').addEventListener('click', ()=>{
  state.cycle.total=randInt(220,320); state.cycle.left=state.cycle.total; state.cycle.seed=Math.floor(Math.random()*2**31);
  saveState(); if(state.planted) renderLeaves(); updateCounts();
});
document.getElementById('devNight').addEventListener('click', ()=>{ state.simNight = state.simNight?0:1; saveState(); });
document.getElementById('devReset').addEventListener('click', ()=>{ if(!confirm('Reset all local progress?')) return; localStorage.removeItem(storeKey); Object.assign(state, loadState()); saveState(); boot(); });

['devFox','devBird','devButterfly','devLady','devAnt','devOwl'].forEach(id=>{
  document.getElementById(id).addEventListener('click', ()=>{
    const def = {devFox:{icon:'ü¶ä',minCP:0,zone:'ground',chance:1,duration:16000},devBird:{icon:'üê¶',zone:'sky',chance:1,duration:6500},devButterfly:{icon:'ü¶ã',zone:'sky',chance:1,duration:6000},devLady:{icon:'üêû',zone:'bark',chance:1,duration:12000},devAnt:{icon:'üêú',zone:'bark',chance:1,duration:12000},devOwl:{icon:'ü¶â',zone:'sky',chance:1,duration:6500}}[id];
    spawnCreature(def);
  });
});

/* Coach/Toast */
const coach=document.getElementById('coach'), coachText=document.getElementById('coachText'), coachCard=document.getElementById('coachCard'), coachArrow=document.getElementById('coachArrow'), coachOk=document.getElementById('coachOk'), coachSkip=document.getElementById('coachSkip'), toast=document.getElementById('toast');
function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),2000); }
function coachTip(text,target,position='top'){
  coachText.textContent=text;
  let rect=null; try{ rect=target.getBoundingClientRect(); }catch{}
  setTimeout(()=>{
    const x=(rect?rect.left+rect.width/2:window.innerWidth/2)-130;
    const y=(rect?(position==='top'?rect.top-80:rect.top+rect.height+16):window.innerHeight/2-60);
    coachCard.style.left=Math.max(12,Math.min(x,window.innerWidth-272))+'px';
    coachCard.style.top=Math.max(12,Math.min(y,window.innerHeight-140))+'px';
    coachArrow.style.left=(rect?rect.left+rect.width/2:window.innerWidth/2)+'px';
    coachArrow.style.top=(rect?rect.top-10:window.innerHeight/2)+'px';
    coach.classList.add('show'); coach.setAttribute('aria-hidden','false');
  },120);
  function close(){ coach.classList.remove('show'); coach.setAttribute('aria-hidden','true'); }
  coachOk.onclick=close; coachSkip.onclick=close; coach.querySelector('.coachMask').onclick=close;
}

/* Save/Boot */
function saveState(){ try{ localStorage.setItem(storeKey, JSON.stringify(state)); }catch(e){} }
function updateDotsAndForest(){ updateDotsUI(); renderForest(); }
function boot(){
  applyPreset('sage');
  ensureForestName(); applySeason(); applyDevUI();
  updateStageBar(); updateDotsAndForest();
  journalBox.value = state.cycle.journal || ""; saveNote.textContent='Saved';
  forestNameLabel.textContent = state.name ? `‚Ä¢ ${state.name}` : '';
  soundToggle.setAttribute('aria-pressed', String(audioEnabled));
  soundToggle.textContent = 'Sound. ' + (audioEnabled ? 'On' : 'Off');
  if(state.planted && state.cycle.left>0){ showTree(); } else { showAcorn(); }
}
plantBtn.addEventListener('click', plant, {passive:true});
resetBtn.addEventListener('click', ()=>{
  if(state.planted) logTodayEntry();
  state.planted=false; state.cycle=makeCycle(); state.day=makeDay();
  saveState(); boot();
});
soundToggle.addEventListener('click', ()=>{
  audioEnabled=!audioEnabled;
  soundToggle.setAttribute('aria-pressed',String(audioEnabled));
  soundToggle.textContent='Sound. '+(audioEnabled?'On':'Off');
});

boot();
setInterval(()=>{ if(state.planted){ renderLeaves(); } }, 9*60*1000);

/* ===== bottom-nav controller ===== */
const outerTabs = {
  home: document.getElementById('tab-home'),
  tree: document.getElementById('tab-tree'),
  profile: document.getElementById('tab-profile'),
  store: document.getElementById('tab-store'),
  explore: document.getElementById('tab-explore')
};
const tabButtons = [...document.querySelectorAll('nav .tab')];

function activateOuter(tab){
  Object.values(outerTabs).forEach(el => el.classList.remove('active'));
  tabButtons.forEach(b => b.classList.toggle('active', b.dataset.tab===tab));

  if(outerTabs[tab]) outerTabs[tab].classList.add('active');
  if(tab==='profile') renderProfileTab();
  localStorage.setItem('samwell.tab', tab);
  location.hash='#'+tab;
}

tabButtons.forEach(b => b.addEventListener('click', ()=>activateOuter(b.dataset.tab)));

(function initTab(){
  const fromHash=(location.hash||'').replace('#','');
  const saved=localStorage.getItem('samwell.tab')||'tree';
  const start=['home','profile','tree','store','explore'].includes(fromHash)?fromHash:saved;
  activateOuter(start);
})();
</script>

<!-- ===== YOUTUBE FEED SCRIPT ===== -->
<script>
const YT_CHANNEL_ID = 'UCCdDJ9Lf8qhH-HOhKM4pEcQ'; // Samwell Worldwide
async function buildYTFeed(limit=8){
  const host = document.getElementById('ytFeed'); if(!host) return;
  try{
    const rss = `https://www.youtube.com/feeds/videos.xml?channel_id=${YT_CHANNEL_ID}`;
    const url = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rss)}`;
    const res = await fetch(url); const data = await res.json();
    const items = (data.items || []).slice(0, limit);
    host.innerHTML = items.length ? items.map(it=>{
      const id = (it.link.split('=')[1] || '').trim();
      const when = new Date(it.pubDate);
      const date = when.toLocaleDateString();
      const title = it.title.replace(/</g,'&lt;').replace(/"/g,'&quot;');
      return `
        <article class="vidCard" data-vid="${id}">
          <div class="vidThumb">
            <img alt="${title}" src="https://i.ytimg.com/vi/${id}/hqdefault.jpg" loading="lazy">
            <button class="playBtn" aria-label="Play video">‚ñ∂</button>
          </div>
          <div class="vTitle">${title}</div>
          <div class="vMeta">Published ${date}</div>
        </article>`;
    }).join('') : `<div class="muted">No videos found.</div>`;
  }catch(err){ host.innerHTML = `<div class="muted">Couldn‚Äôt load videos.</div>`; }
}
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('.playBtn'); if(!btn) return;
  const card = btn.closest('.vidCard'); const id = card?.dataset?.vid; if(!id) return;
  card.querySelector('.vidThumb').innerHTML =
    `<div class="ytWrap"><iframe
      src="https://www.youtube.com/embed/${id}?autoplay=1&rel=0"
      title="YouTube video"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe></div>`;
});
buildYTFeed();
window.addEventListener('hashchange', ()=>{ if(location.hash === '#home') buildYTFeed(); });
</script>

</body>
</html>